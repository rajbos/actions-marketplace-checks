name: Cleanup Invalid Repos
on:
  workflow_dispatch:
    inputs:
      numberOfReposToDo:
        description: 'Number of repos to cleanup'
        required: false
        default: '10'
      dryRun:
        description: 'Dry run (true/false)'
        required: false
        default: 'true'

  schedule:
    # Run weekly on Sundays at 2 AM UTC
    - cron: '0 2 * * 0'
    
jobs:
  cleanup-invalid-repos:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
          
      - shell: pwsh
        name: Run cleanup script
        run: |
           ./.github/workflows/cleanup-invalid-repos.ps1 -numberOfReposToDo ${{ github.event.inputs.numberOfReposToDo || '10' }} -access_token "${{ secrets.ACCESS_TOKEN }}" -dryRun $${{ github.event.inputs.dryRun || 'true' }}

      - name: Commit and push changes
        if: github.event.inputs.dryRun != 'true'
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          git add status.json
          git commit -m "Update status.json after cleanup" || echo "No changes to commit"
          git push
